version: 1
backend:
  phases:
    preBuild:
      commands:
        - echo "Setting up Python environment for Amplify"
        - echo "Python version:"
        - python3 --version
        - echo "Pip version:"
        - python3 -m pip --version
        - cd backend
        - echo "Installing Python dependencies"
        - python3 -m pip install --user -r requirements-prod.txt
    build:
      commands:
        - echo "Running database migrations"
        - cd backend
        - python3 -m alembic upgrade head || echo "Skipping migrations - database may not be configured"
        - echo "Backend build completed"
    postBuild:
      commands:
        - echo "Backend post-build setup completed"
  artifacts:
    baseDirectory: backend
    files:
      - '**/*'
  cache:
    paths:
      - ~/.cache/pip/**/*
frontend:
  phases:
    preBuild:
      commands:
        - cd frontend/frontend
        - npm ci
    build:
      commands:
        - cd frontend/frontend
        - npm run build
  artifacts:
    baseDirectory: frontend/frontend/.next
    files:
      - '**/*'
  cache:
    paths:
      - frontend/frontend/node_modules/**/*