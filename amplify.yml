version: 1
backend:
  phases:
    preBuild:
      commands:
        - echo "Installing Python 3.11 and setting up environment"
        - yum update -y
        - yum install -y python3 python3-pip python3-devel gcc
        - python3 -m pip install --upgrade pip
        - cd backend
        - echo "Installing Python dependencies"
        - pip3 install -r requirements.txt
    build:
      commands:
        - echo "Running database migrations"
        - cd backend
        - alembic upgrade head || echo "Skipping migrations - database may not be configured"
        - echo "Build completed"
    postBuild:
      commands:
        - echo "Post-build setup completed"
  artifacts:
    baseDirectory: backend
    files:
      - '**/*'
  cache:
    paths:
      - backend/.cache/pip/**/*
frontend:
  phases:
    preBuild:
      commands:
        - cd frontend/frontend
        - npm ci
    build:
      commands:
        - cd frontend/frontend
        - npm run build
  artifacts:
    baseDirectory: frontend/frontend/.next
    files:
      - '**/*'
  cache:
    paths:
      - frontend/frontend/node_modules/**/*